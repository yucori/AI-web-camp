## 스레드 safety란?

> 스레드 안전(Thread safety)은 멀티 스레드 프로그래밍에서 일반적으로 어떤 함수나 변수, 혹은 객체가 여러 스레드로부터 동시에 접근이 이루어져도 프로그램의 실행에 문제가 없음을 뜻한다. 즉 어떤 함수가 한 스레드로부터 호출되어 실행 중일 때, 다른 스레드가 그 함수를 호출하여 동시에 함께 실행하더라도 각 스레드에서의 함수의 수행 결과가 올바르게 나오는 것을 뜻한다.

스레드 안전 상태인지 판단하기 위해서는 아래의 조건들에 부합해야 한다.

1. 전역 변수나 힙, 파일과 같이 여러 스레드가 동시에 접근할 수 있는 자원을 사용해야 한다.
2. 핸들과 포인터를 통한 데이터의 간접 접근이 가능해야 한다.
3. 부수 효과를 가져오는 코드가 있어야 한다.

스레드 안전을 지키기 위한 방법들은 아래와 같다.

1. Re-entrancy(재 진입성)

- 어떤 함수가 한 스레드에 의해 호출되어 실행 중일 때, 다른 스레드가 그 함수를 호출하더라도 그 결과가 각각에게 올바로 주어져야 한다.
- 각각의 스레드들이 독립적으로 동작할 수 있도록 코드를 작성하여야 한다.

1. Thread-local storage(쓰레드 지역 저장소)

- 공유 자원의 사용을 최대한 줄여 각각의 스레드에서만 접근 가능한 저장소들을 사용함으로써 동시 접근을 막는다.
- 이 방법은 동기화 방법과 관련되어 있으며 공유 상태를 피할 수 없을 때 사용하는 방식이다.
- 전역 변수 사용을 자제하는 것으로도 이룰 수 있다.

1. Mutual exclusion(상호 배제)

- 공유자원에 하나의 스레드만 접근하여 상호 배제가 지켜지도록 세마포/ 뮤텍스 등의 락으로 통제한다.
- 일반적으로 많이 사용된다.

1. Atomic operations(원자 연산)

- 공유 자원에 접근할 때 원자 연산을 이용하거나 원자적으로 정의된 접근 방법을 사용함으로써 상호 배제를 구현할 수 있다.
- 원자적이라는 것은 데이터의 변경이 이루어지는 시점에 락을 걸어 데이터를 변경하는 동안 다른 스레드의 접근이 불가능하도록 막는 것을 말한다.
